'use client';

import { createContext, useContext, useEffect, useMemo, useState } from 'react';

export type Language = 'en' | 'ja';

type TranslateParams = Record<string, string | number>;

type LanguageContextValue = {
  language: Language;
  locale: string;
  setLanguage: (next: Language) => void;
  t: (key: string, fallback: string, params?: TranslateParams) => string;
};

const languageOptions: { value: Language; label: string }[] = [
  { value: 'en', label: 'English' },
  { value: 'ja', label: '日本語' },
];

const dictionaries: Record<Language, Record<string, string>> = {
  en: {
    'language.select': 'Select language',
    'workspace.nav.label': 'Workspace sections',
  },
  ja: {
    'layout.tagline': 'モダンな請求書ワークスペース',
    'language.select': '言語を選択',
    'nav.features': '機能',
    'nav.templates': 'テンプレート',
    'nav.workflow': 'ワークフロー',
    'nav.pricing': '料金',
    'nav.privacy': 'プライバシー',
    'nav.signIn': 'ログイン',
    'nav.launchApp': 'アプリを起動',
    'footer.tagline': 'デザイナーに頼らずに、洗練された請求書と領収書 PDF を作成できます。マーケティングサイトとワークスペースは同じデザインシステムを共有しています。',
    'footer.explore': '製品ツアー',
    'footer.company': '会社情報',
    'footer.featureTour': '機能紹介',
    'footer.templateGallery': 'テンプレートギャラリー',
    'footer.pricing': '料金',
    'footer.privacy': 'プライバシーポリシー',
    'footer.supportEmail': 'サポート',
    'footer.admin': '管理コンソール',
    'landing.hero.badge': '請求書・領収書ワークスペース',
    'landing.hero.title': 'Easy Invoice GM7 で請求書作成をもっとシンプルに',
    'landing.hero.subtitle': 'ブランドに合わせたテンプレートを選び、PDF を数分でダウンロード。Firebase と連携した最新の請求書ワークスペースです。',
    'landing.hero.ctaPrimary': '無料で始める',
    'landing.hero.ctaSecondary': '機能を見る',
    'landing.hero.cardBadge': 'ライブプレビュー',
    'landing.hero.cardTitle': 'Easy Invoice GM7 キャンバス',
    'landing.hero.cardBody': '色や文言、支払い条件の変更がリアルタイムに PDF に反映され、顧客が確認する内容を常に把握できます。',
    'landing.hero.switchReasons': '選ばれる理由',
    'landing.hero.reason1': 'デザインツールは不要',
    'landing.hero.reason2': '共有テンプレートライブラリ',
    'landing.hero.reason3': '財務レビューを通過する PDF',
    'landing.stats.teams': '毎月 Atlas で請求書を作成するチーム',
    'landing.stats.speed': '下書きからダウンロードまでの平均時間',
    'landing.stats.currencies': '自動フォーマット対応通貨数',
    'landing.section.features': '主な機能',
    'landing.section.templates': 'テンプレート',
    'landing.section.workflow': 'ワークフロー',
    'landing.section.pricing': '料金プラン',
    'landing.features.subtitle': 'フォームの速度とレイアウトエディターの柔軟性を兼ね備えたワークスペースです。',
    'landing.workflow.step1.title': 'キャンバスをパーソナライズ',
    'landing.workflow.step1.body': 'ロゴをアップロードし、テンプレートを選択し、サービス説明や税に関する文言を再利用可能なブロックとして設定します。',
    'landing.workflow.step2.title': '一度入力すれば再利用',
    'landing.workflow.step2.body': '顧客情報、支払い条件、振込先情報を保存しておけば、次の書類は完成された状態から開始できます。',
    'landing.workflow.step3.title': 'すぐに共有',
    'landing.workflow.step3.body': 'ベクター品質の PDF をエクスポートしたり、安全なリンクやブランドメールで送信したりできます。リマインダーも自動です。',
    'landing.pricing.starter.tier': 'スターター',
    'landing.pricing.starter.description': '忙しい作業を省きつつ、プロフェッショナルな請求書が必要な個人向け。',
    'landing.pricing.growth.tier': 'グロース',
    'landing.pricing.growth.description': 'チームでの共同編集、バージョン管理、自動化機能をすべて解放します。',
    'landing.pricing.enterprise.tier': 'エンタープライズ',
    'landing.pricing.enterprise.description': 'カスタムテンプレート、SSO、専任サポートを備えた SOC2 対応の導入です。',
    'landing.pricing.contact': 'ご相談ください',
    'landing.pricing.currencyHint': '日本では月額 999 円、その他の地域では月額 10 ドルで利用できます。',
    'landing.pricing.cta': '今すぐ始める',
    'landing.templates.heading': 'テンプレートギャラリー',
    'landing.templates.body': 'クリックひとつでレイアウトを切り替え。タイポグラフィやカラー、サマリーブロックも崩れません。',
    'landing.workflow.heading': '3 ステップで完了',
    'landing.workflow.subtitle': 'ドラフト作成から入金まで、Easy Invoice GM7 がチームと顧客の信頼を支えます。',
    'landing.pricing.heading': '料金プラン',
    'landing.pricing.subtitle': '無料で始め、コラボレーションや自動化が必要になったタイミングでアップグレードできます。',
    'landing.features.heading': '主な機能',
    'landing.cta.title': '次の請求書を今すぐ送信しましょう',
    'landing.cta.body': '数分で洗練された請求書を作成し、すべての顧客接点をブランドに合わせましょう。',
    'landing.cta.primary': 'ワークスペースを起動',
    'landing.cta.secondary': 'ダッシュボードを見る',
    'landing.testimonial.cta': 'テンプレートをもっと見る',
    'workspace.nav.overview': '概要',
    'workspace.nav.invoices': '請求書',
    'workspace.nav.templates': 'テンプレート',
    'workspace.nav.clients': '顧客',
    'workspace.nav.activity': 'アクティビティ',
    'workspace.nav.settings': '設定',
    'workspace.hint': 'Firebase のデモ環境に接続しています。',
    'workspace.userMenu.label': 'アカウント操作',
    'workspace.actions.save': '請求書を保存',
    'workspace.actions.saving': '保存中…',
    'workspace.actions.download': 'PDF をダウンロード',
    'workspace.actions.downloading': '生成中…',
    'workspace.actions.preview': 'プレビューを表示',
    'workspace.actions.createInvoice': '請求書を作成',
    'workspace.actions.viewDashboard': 'ダッシュボードを見る',
    'workspace.actions.signIn': 'サインイン',
    'workspace.actions.signOut': 'サインアウト',
    'workspace.actions.adminConsole': '管理コンソール',
    'workspace.alert.success': 'Firestore に請求書を保存しました。',
    'workspace.alert.offline': 'Firebase に接続できません。サンプル請求書を表示しています。',
    'workspace.alert.offlineStored': 'Firebase が未設定のため、このセッション内にローカル保存しました。',
    'workspace.alert.error': '請求書を保存できませんでした。',
    'workspace.alert.downloaded': '請求書の PDF をダウンロードしました。',
    'workspace.alert.signedOut': 'サインアウトしました。Firebase と同期するには再度サインインしてください。',
    'workspace.status.draft': '下書き',
    'workspace.status.sent': '送信済み',
    'workspace.status.paid': '支払い済み',
    'workspace.status.overdue': '支払い遅延',
    'workspace.dashboard.outstanding': '未回収残高',
    'workspace.dashboard.paid': '今月の入金額',
    'workspace.dashboard.paymentTime': '平均入金日数',
    'workspace.dashboard.paymentDelta': '先月比 -2.1 日',
    'workspace.dashboard.paymentDuration': '9.4 日',
    'workspace.dashboard.trackCount': '{count} 件の請求書を管理中',
    'workspace.dashboard.noInvoices': '請求書はまだありません',
    'workspace.dashboard.reconciled': '顧客の入金履歴と自動照合',
    'workspace.dashboard.reminders': 'リマインダーを自動送信',
    'workspace.dashboard.reminderHint': '今週のフォローアップは 3 件',
    'workspace.dashboard.templates': '利用中のテンプレート',
    'workspace.dashboard.templatesHint': 'ギャラリーからいつでも切り替えできます。',
    'workspace.invoice.heading': '請求書ワークスペース',
    'workspace.invoice.description': '編集ビューとプレビュービューを切り替えて、整った書類を確認できます。',
    'workspace.invoice.viewLabel': '請求書ワークスペースビュー',
    'workspace.view.edit': '編集',
    'workspace.view.preview': 'プレビュー',
    'workspace.section.dashboard.description': '請求ワークスペースの状況を確認します。',
    'workspace.section.invoices.description': '下書きとプレビューを切り替えて調整します。',
    'workspace.section.templates.description': 'テンプレートを選択してレイアウトを変更します。',
    'workspace.section.clients.description': '顧客ごとの入金状況と履歴を確認します。',
    'workspace.section.activity.description': '保存、リマインダー、支払いを時系列で表示します。',
    'workspace.section.settings.description': '新規請求書で使用する既定値を管理します。',
    'workspace.section.business': '事業者情報',
    'workspace.section.businessDescription': 'すべての請求書の先頭に表示される情報です。',
    'workspace.section.client': '顧客情報',
    'workspace.section.lines': '明細',
    'workspace.section.summary': 'サマリー',
    'workspace.section.notes': '備考',
    'workspace.section.terms': '請求条件',
    'workspace.section.termsDescription': '合計に反映される日付、通貨、税率を設定します。',
    'workspace.section.linesDescription': 'サービス内容、数量、単価を入力します。',
    'workspace.field.businessName': '会社名',
    'workspace.field.businessAddress': '住所',
    'workspace.field.clientName': '顧客名',
    'workspace.field.clientEmail': '顧客メール',
    'workspace.field.clientAddress': '顧客住所',
    'workspace.field.issueDate': '発行日',
    'workspace.field.dueDate': '支払期日',
    'workspace.field.currency': '通貨',
    'workspace.field.status': 'ステータス',
    'workspace.field.tax': '税率',
    'workspace.lines.description': '内容',
    'workspace.lines.quantity': '数量',
    'workspace.lines.rate': '単価',
    'workspace.lines.amount': '金額',
    'workspace.lines.add': '明細を追加',
    'workspace.lines.remove': '削除',
    'workspace.lines.descriptionPlaceholder': '提供したサービス',
    'workspace.summary.subtotal': '小計',
    'workspace.summary.tax': '税額',
    'workspace.summary.total': '合計',
    'workspace.summary.notes': '支払い条件やメモ',
    'workspace.template.bestFor': 'おすすめ用途',
    'workspace.template.highlights': '特長',
    'workspace.template.villa-coastal.name': 'Villa Coastal',
    'workspace.template.villa-coastal.description': 'リゾートの領収書をイメージしたブルーのヘッダーと予約サマリーを備えたレイアウトです。',
    'workspace.template.villa-coastal.bestFor': 'ホテルやバケーションレンタルなど、滞在内容をわかりやすくまとめたいチームに最適。',
    'workspace.template.villa-coastal.highlights.0': 'ワイドなコースタルヘッダー',
    'workspace.template.villa-coastal.highlights.1': '予約・支払いバッジ',
    'workspace.template.villa-coastal.highlights.2': '軽やかな区切り線で読みやすい明細',
    'workspace.template.atelier-minimal.name': 'Atelier Minimal',
    'workspace.template.atelier-minimal.description': 'ハイコントラストなモノクロ配色で、余白を生かした洗練されたレイアウトです。',
    'workspace.template.atelier-minimal.bestFor': 'ブティックスタジオやコンサルティングなど、タイムレスな帳票を求めるチーム向け。',
    'workspace.template.atelier-minimal.highlights.0': '落ち着いたニュートラルパレット',
    'workspace.template.atelier-minimal.highlights.1': '右寄せのメタデータカラム',
    'workspace.template.atelier-minimal.highlights.2': '署名しやすいサマリーフッター',
    'workspace.template.classic-ledger.name': 'Classic Ledger',
    'workspace.template.classic-ledger.description': '印刷にも強いモノクロレイアウトで永続的なデザイン。',
    'workspace.template.classic-ledger.bestFor': '法務・財務チームなど、色を使わないフォーマットを求めるケースに。',
    'workspace.template.classic-ledger.highlights.0': '高コントラストのテーブル',
    'workspace.template.classic-ledger.highlights.1': '署名欄付きフッター',
    'workspace.template.classic-ledger.highlights.2': '印刷に最適な設計',
    'workspace.template.aqua-ledger.name': 'Aqua Ledger',
    'workspace.template.aqua-ledger.description': 'ティールのバナーと交互の行シェーディングで、サブスクリプション請求をスタイリッシュに見せます。',
    'workspace.template.aqua-ledger.bestFor': 'SaaS やプロダクトチームなど、定期的な請求を行うケースに最適。',
    'workspace.template.aqua-ledger.highlights.0': 'バランスステータスカプセル',
    'workspace.template.aqua-ledger.highlights.1': '交互のアクアストライプ',
    'workspace.template.aqua-ledger.highlights.2': '支払いリマインダー付きメモ',
    'workspace.template.seikyu.name': '請求書（Seikyūsho）',
    'workspace.template.seikyu.description': '日本語と英語の見出し、判子欄、税サマリーを備えたレイアウト。',
    'workspace.template.seikyu.bestFor': '日本の取引先へローカライズした請求書を発行するチーム向け。',
    'workspace.template.seikyu.highlights.0': '判子欄付きフッター',
    'workspace.template.seikyu.highlights.1': '税サマリー行',
    'workspace.template.seikyu.highlights.2': '二言語のカラム',
    'workspace.template.royal-balance.name': 'Royal Balance',
    'workspace.template.royal-balance.description': 'マゼンタとバイオレットのグラデーションヘッダーで、高級感のある請求書を演出します。',
    'workspace.template.royal-balance.bestFor': 'プレミアムなクリエイティブ案件やキャンペーン請求に最適。',
    'workspace.template.royal-balance.highlights.0': 'グラデーションのヒーローヘッダー',
    'workspace.template.royal-balance.highlights.1': 'バランスバッジと強調された合計',
    'workspace.template.royal-balance.highlights.2': '柔らかなノートエリア',
    'workspace.template.harbour-slate.name': 'Harbour Slate',
    'workspace.template.harbour-slate.description': '旅行明細に合わせたブルーグレーのヘッダーと予約サマリーを備えたレイアウトです。',
    'workspace.template.harbour-slate.bestFor': 'ホテルや旅行代理店など、滞在情報を丁寧にまとめたいケースに。',
    'workspace.template.harbour-slate.highlights.0': '滞在サマリー向けのメタカラム',
    'workspace.template.harbour-slate.highlights.1': 'スリムなキーラインと整列テーブル',
    'workspace.template.harbour-slate.highlights.2': '署名用のフッター領域',
    'workspace.templates.instructions': 'テンプレートを選んで請求書をスタイリングします。',
    'workspace.templates.count': '{count} 件のテンプレート',
    'workspace.templates.spotlight': '注目のテンプレート',
    'workspace.templates.spotlightDescription': '今週クライアントから人気のテンプレートをご紹介します。',
    'workspace.templates.browse': 'ギャラリーを見る',
    'workspace.templates.galleryHeading': 'テンプレートギャラリー',
    'workspace.templates.galleryDescription': '適用前に各テンプレートのレイアウトを確認できます。',
    'workspace.recent.heading': '最近の請求書',
    'workspace.recent.description': '下書き、送信済み、支払い状況をまとめて確認できます。',
    'workspace.recent.loading': '請求書を読み込み中…',
    'workspace.recent.empty': 'まだ請求書がありません。右上のボタンから作成してください。',
    'workspace.table.client': '顧客',
    'workspace.table.status': 'ステータス',
    'workspace.table.issued': '発行日',
    'workspace.table.due': '支払期日',
    'workspace.table.total': '合計',
    'workspace.table.clientPlaceholder': '顧客',
    'workspace.clients.heading': '顧客サマリー',
    'workspace.clients.description': '顧客ごとの未回収残高と最近の請求書を確認できます。',
    'workspace.clients.add': '顧客を追加',
    'workspace.clients.autofillHint': '保存済みの顧客を選ぶと詳細が自動入力されます。',
    'workspace.activity.heading': '最近のアクティビティ',
    'workspace.activity.description': '保存、リマインダー、支払い状況を最新順で表示します。',
    'workspace.activity.viewAdmin': '管理コンソールを見る',
    'workspace.activity.empty': '請求書を保存するとアクティビティが表示されます。',
    'workspace.settings.heading': '設定',
    'workspace.settings.description': '新しい請求書で使用する既定の情報です。',
    'workspace.settings.currencyDefault': '既定の通貨',
    'workspace.settings.taxDefault': '既定の税率',
    'workspace.settings.businessName': '会社名',
    'workspace.settings.businessAddress': '住所',
    'workspace.clients.outstanding': '未回収',
    'workspace.clients.lastInvoice': '最終請求日',
    'workspace.clients.status': 'ステータス',
    'workspace.clients.invoices': '請求書数',
    'workspace.clients.empty': '請求書を保存すると顧客リストが構築されます。',
    'workspace.activity.followUps': 'フォローアップ',
    'workspace.notes.placeholder': '支払い条件や感謝の言葉を記載できます。',
    'workspace.settings.reminders': 'リマインドメール',
    'workspace.settings.reminderDetails': '有効 — 期日の 3 日前に送信',
    'workspace.settings.template': 'テンプレート',
    'workspace.settings.updateProfile': 'プロフィールを更新',
    'workspace.settings.manageAutomations': '自動化を管理',
    'workspace.placeholder.businessName': 'Atlas Studio',
    'workspace.placeholder.businessAddress': '〒100-0005 東京都千代田区丸の内 1-9-1',
    'workspace.placeholder.clientName': 'ノースウィンド株式会社',
    'workspace.placeholder.clientEmail': 'client@example.com',
    'workspace.placeholder.clientAddress': '〒100-0005 東京都千代田区丸の内 1-9-1',
    'workspace.preview.businessPlaceholder': '会社名を入力してください',
    'workspace.preview.addressPlaceholder': '会社住所を追加してください',
    'workspace.preview.totalDue': '支払予定額',
    'workspace.preview.status': 'ステータス',
    'workspace.preview.billToDual': '請求先 / Bill to',
    'workspace.preview.billTo': '請求先',
    'workspace.preview.issuedDual': '発行日 / Issued',
    'workspace.preview.issued': '発行日',
    'workspace.preview.dueDual': '支払期日 / Due',
    'workspace.preview.due': '支払期日',
    'workspace.preview.descriptionDual': '品目 / Item',
    'workspace.preview.description': '明細',
    'workspace.preview.quantityDual': '数量 / Qty',
    'workspace.preview.quantity': '数量',
    'workspace.preview.rateDual': '単価 / Rate',
    'workspace.preview.rate': '単価',
    'workspace.preview.amountDual': '金額 / Total',
    'workspace.preview.amount': '金額',
    'workspace.preview.subtotalDual': '小計 / Subtotal',
    'workspace.preview.taxDual': '税額 / Tax',
    'workspace.preview.totalDual': '合計 / Total',
    'workspace.preview.clientPlaceholder': '顧客名',
    'workspace.preview.emailPlaceholder': 'client@email.com',
    'workspace.preview.addressPlaceholder': '顧客住所を追加',
    'workspace.preview.linePlaceholderJa': 'サービス',
    'workspace.preview.linePlaceholder': '明細を入力',
    'workspace.preview.paymentSummary': '支払いサマリー',
    'workspace.preview.hankoLabel': '印',
    'workspace.preview.hankoCaption': '社判',
    'workspace.preview.notesDual': '備考 / Notes',
    'workspace.preview.notes': '備考',
    'workspace.preview.notesPlaceholder': '支払い手順やお礼のメッセージを追加できます。',
    'workspace.preview.notesHint': 'お支払い期限までにお振り込みをお願いいたします。',
    'workspace.nav.label': 'ワークスペースのメニュー',
    'workspace.shell.brandSubtitle': '請求ワークスペース',
    'workspace.pdf.invoiceTitle': '請求書',
    'workspace.pdf.billTo': '請求先',
    'workspace.pdf.issueDate': '発行日',
    'workspace.pdf.dueDate': '支払期日',
    'workspace.pdf.status': 'ステータス',
    'workspace.pdf.currency': '通貨',
    'workspace.pdf.description': '明細',
    'workspace.pdf.quantity': '数量',
    'workspace.pdf.rate': '単価',
    'workspace.pdf.amount': '金額',
    'workspace.pdf.subtotal': '小計',
    'workspace.pdf.tax': '税額',
    'workspace.pdf.total': '合計',
    'workspace.pdf.notes': '備考',
    'admin.heading': 'Easy Invoice GM7 管理コンソール',
    'admin.console.badge': '管理者エリア',
    'admin.console.title': 'Easy Invoice GM7 管理コンソール',
    'admin.console.description': 'アクティビティを監査し、システム状況を監視し、サポート依頼を円滑に処理します。ワークスペース利用者はアクセスできません。',
    'admin.console.switchMember': 'メンバーログインに切り替え',
    'admin.console.openWorkspace': 'ワークスペースを開く',
    'admin.console.errorSample': 'ライブデータにアクセスできません。サンプル請求書を表示しています。',
    'admin.console.missingFirebase': 'Firebase の資格情報を接続するとライブデータが表示されます。',
    'admin.console.metrics.heading': '主要指標',
    'admin.console.metrics.description': '利用状況やパイプラインを把握できます。',
    'admin.console.metrics.loading': '読み込み中…',
    'admin.console.metrics.updated': '{time} に更新',
    'admin.metrics.activeUsers': 'アクティブユーザー',
    'admin.metrics.activeUsersDelta': '先週比 +12.5%',
    'admin.metrics.pendingApprovals': '承認待ち',
    'admin.metrics.pendingApprovalsDelta': '先週比 -2',
    'admin.metrics.pdfRenders': 'PDF 生成 (24 時間)',
    'admin.metrics.pdfRendersDelta': '昨日比 +48',
    'admin.metrics.outstanding': '未回収残高',
    'admin.metrics.outstandingHint': '未払い請求書の合計',
    'admin.metrics.paid': '今月の入金額',
    'admin.metrics.paidHint': '支払い済み請求書のみ',
    'admin.metrics.tickets': '未解決サポート',
    'admin.table.recent': '最近の請求書',
    'admin.table.client': '顧客',
    'admin.table.total': '合計',
    'admin.table.status': 'ステータス',
    'admin.table.created': '作成日時',
    'admin.timeline.heading': '最新アクティビティ',
    'admin.console.health.heading': 'システムステータス',
    'admin.console.health.description': '請求書配信を支える各種統合の状態です。',
    'admin.health.firestore.name': 'Firestore 接続',
    'admin.health.firestore.detail': '平均レイテンシ 82ms',
    'admin.health.pdfQueue.name': 'PDF レンダリングキュー',
    'admin.health.pdfQueue.detail': 'バックログなし — ワーカー 4 台稼働',
    'admin.health.email.name': 'メール配信',
    'admin.health.email.detail': 'ソフトバウンス 1.2% — 監視中',
    'admin.health.status.operational': '稼働中',
    'admin.health.status.degraded': '一部障害',
    'admin.health.status.maintenance': 'メンテナンス',
    'admin.console.activity.heading': '最近のアクティビティ',
    'admin.console.activity.description': 'すべてのワークスペースで最新の請求書更新を表示します。',
    'admin.console.activity.viewWorkspace': 'ワークスペースのタイムラインを見る',
    'admin.console.activity.unknown': '不明',
    'admin.console.activity.empty': 'まだ請求書アクティビティがありません。請求書を保存すると表示されます。',
    'admin.support.heading': 'サポートキュー',
    'admin.console.support.heading': 'サポートキュー',
    'admin.console.support.description': '請求チームから対応が必要とされているリクエストです。',
    'admin.landing.badge': '管理者サインイン',
    'admin.landing.title': '安全なアクセスが必要です',
    'admin.landing.description': '管理者はワークスペース、サブスクリプション、コンプライアンスログを専用コンソールで管理します。下のボタンからコンソールを起動し、管理者資格情報でサインインしてください。',
    'admin.landing.openConsole': '管理コンソールを開く',
    'admin.landing.returnSite': 'マーケティングサイトに戻る',
    'admin.landing.help': 'アクセスに問題がありますか？admin@easyinvoicegm7.example.com までご連絡ください。',
    'login.badge': 'おかえりなさい',
    'login.title': 'Easy Invoice GM7 にサインイン',
    'login.subtitle': 'ワークスペースのメールアドレスを入力してください。',
    'login.email': 'メールアドレス',
    'login.password': 'パスワード',
    'login.remember': 'サインイン状態を保持',
    'login.submit': '続行',
    'login.placeholder.email': 'you@company.com',
    'login.placeholder.password': '••••••••',
    'login.error.credentials': 'メールアドレスとパスワードを入力してください。',
    'login.error.missingFirebase': 'Firebase の環境変数が見つかりません。next-app/.env.example を .env.local にコピーし、プロジェクトの情報を設定してください。',
    'login.error.sessionExpired': 'セッションの有効期限が切れました。再度サインインしてください。',
    'login.error.accessDenied': '管理者アカウントでサインインしてコンソールを開いてください。',
    'login.error.default': '続行するにはサインインしてください。',
    'login.error.generic': 'サインインできませんでした。時間をおいて再試行してください。',
    'login.status.signingIn': 'サインインしています…',
    'login.status.success': 'サインインしました。リダイレクト中…',
    'login.callout.heading': '設定が必要です:',
    'login.callout.config': '.env.example を .env.local にコピーし、このリポジトリの Firebase キー（または独自の資格情報）を設定してください。',
    'login.link.forgot': 'パスワードをお忘れですか？',
    'login.link.signup': 'アカウントを作成',
    'login.note.adminPrefix': '管理者は次のページからアクセス権を管理できます',
    'login.note.adminLink': '管理コンソール',
    'login.aside.title': 'ダッシュボードの機能をすべてブラウザで',
    'login.aside.point1': 'Flutter 版と同じテンプレートギャラリーで請求書を作成。',
    'login.aside.point2': '支払い状況、リマインダー、未回収残高を一か所で確認。',
    'login.aside.point3': 'ダッシュボード、請求書エディター、テンプレート、顧客画面をトップナビで切り替え。',
    'login.aside.cta': 'ワークスペースを見る',
    'privacy.updated': '最終更新日: 2024 年 10 月 12 日',
    'privacy.intro.title': 'プライバシーポリシー',
    'privacy.intro.body': 'Easy Invoice GM7 (以下「当社」) は、利用者の個人情報を安全に扱うことを最優先に考えています。このポリシーでは、収集するデータ、利用目的、保存方法、そして利用者が持つ権利について説明します。',
    'privacy.collection.title': '収集する情報',
    'privacy.collection.body': 'アカウント作成や利用時に、氏名、メールアドレス、会社情報、請求書に含まれる顧客データなどを収集することがあります。',
    'privacy.usage.title': '利用目的',
    'privacy.usage.body': '収集した情報は、請求書の生成、アカウントの管理、サービス品質の向上、重要なお知らせの配信に利用します。',
    'privacy.storage.title': '保管とセキュリティ',
    'privacy.storage.body': 'データは Firebase で暗号化して保存し、アクセス制御を設定しています。必要以上に長期間保持しません。',
    'privacy.rights.title': '利用者の権利',
    'privacy.rights.body': '利用者は、自身のデータへのアクセス、修正、削除を要求する権利があります。support@easyinvoicegm7.example.com までお問い合わせください。',
    'privacy.contact.title': 'お問い合わせ',
    'privacy.contact.body': 'プライバシーに関するご質問は support@easyinvoicegm7.example.com までお寄せください。',
  },
};

const LanguageContext = createContext<LanguageContextValue | undefined>(undefined);

function applyParams(template: string, params?: TranslateParams): string {
  if (!params) return template;
  return template.replace(/\{(\w+)\}/g, (_, key) => String(params[key] ?? ''));
}

export function LanguageProvider({ children }: { children: React.ReactNode }) {
  const [language, setLanguage] = useState<Language>(() => {
    if (typeof window !== 'undefined') {
      const stored = window.localStorage.getItem('easy-invoice-language') as Language | null;
      if (stored === 'en' || stored === 'ja') {
        return stored;
      }
    }
    return 'en';
  });

  useEffect(() => {
    if (typeof window === 'undefined') {
      return;
    }
    const stored = window.localStorage.getItem('easy-invoice-language') as Language | null;
    if (stored === 'en' || stored === 'ja') {
      return;
    }
    const browser = window.navigator.language.startsWith('ja') ? 'ja' : 'en';
    setLanguage((current) => (current === browser ? current : browser));
  }, []);

  useEffect(() => {
    if (typeof window === 'undefined') {
      return;
    }
    document.documentElement.lang = language === 'ja' ? 'ja' : 'en';
    window.localStorage.setItem('easy-invoice-language', language);
  }, [language]);

  const locale = language === 'ja' ? 'ja-JP' : 'en-US';

  const value = useMemo<LanguageContextValue>(
    () => ({
      language,
      locale,
      setLanguage: (next) => setLanguage(next),
      t: (key, fallback, params) => {
        const dictionary = dictionaries[language];
        const template = dictionary?.[key] ?? fallback;
        return applyParams(template, params);
      },
    }),
    [language, locale],
  );

  return <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>;
}

export function useTranslation(): LanguageContextValue {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useTranslation must be used within a LanguageProvider');
  }
  return context;
}

export { languageOptions };
